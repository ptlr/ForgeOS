# B001 多线程环境下基础函数不可靠

在多线程环境下，一些用来输出错误信息的基础函数不可靠，需要重新处理。

目前主要有两个：

* 以前写的中断处理函数
* 字符串输出函数

解决方法：

在功能构建的过程中，主要使用线程同步机制，控制资源访问。

在debug工具中，不能采用高级的工具，需要采取关中断或恢复中断的方式，需要注意的是在开中断与关中断的过程中需要获取之前的中断状态，再恢复状态，如下：

```c
// 在关中断的同时返回之前的中断状态，无论此前是开启还是关闭
enum IntrStatus oldStatus = intrDisable();

// 其他代码

// 恢复中断状态
setIntrStatus(oldStatus);
```

如此，不会更改其他部分设置的中断状态，能让中断状态一直处于正确的状态。